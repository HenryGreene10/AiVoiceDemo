
/* === AI Listen overrides (place at very end) === */

:root{
  --mp-font: "Courier New", monospace;
  --mp-bg: #fffdf8;
  --mp-fg: #1a1c1a;
  --mp-muted: #6b5a46;
  --mp-accent: #8d6b4f;
  --mp-border: #e0c9a6;
  --mp-radius: 16px;
  --mp-shadow: 0 16px 40px rgba(0,0,0,.15);
  --mp-gap-top: 16px;
  --mp-gap-bottom: 0px;
  --mp-controls-gap: 4px;
  --mp-width: 820px;
  --mp-btn-center: 56px;
  --mp-btn-side: 42px;
  --mp-icon-center: 30px;
  --mp-icon-side: 56px;
  --mp-track-h: 2px;
  --mp-knob: 6px;
  --mp-progress-bg: #e9d6bd;
  --mp-progress-fill: #8d6b4f;
  --mp-center-nudge-x: 0px;
  --mp-center-nudge-y: 0px;
  --mp-side-nudge-x: -6px;
  --mp-side-nudge-y: 0px;
  --ai-mini-pad: 140px;
}

/* Title: true ellipsis */
.ai-title{
  display:block;
  max-width:100%;
  min-width:0;
  font-weight:650; font-size:15px; line-height:1.25;
  margin:0 0 8px 0;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  text-align:center;
}

/* 3) Single mini-player placement (keep ONE copy only) */
.ai-mini-root{
  position: fixed;
  right: 32px;
  bottom: calc(24px + env(safe-area-inset-bottom));
  width: min(360px, calc(100vw - 48px));
  max-width: 100%;
  transform: translateY(120%) scale(.98);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
  z-index: 999998;
  background: transparent;
  padding: 0;
  border-radius: 0;
  box-shadow: none;
  font-family: var(--mp-font);
  box-sizing: border-box;
  pointer-events: none;
}
.ai-mini-root.show{
  transform: translateY(0) scale(1);
  opacity:1;
  pointer-events:auto;
}
.ai-mini-root.hidden{ pointer-events:none; }
.ai-mini-root .ai-card{
  width: 100%;
  max-width: 100%;
  margin: 0;
}

@media (max-width: 768px){
  :root{
    --ai-mini-pad: 110px;
  }
  .ai-mini-root{
    left: 0;
    right: 0;
    bottom: calc(12px + env(safe-area-inset-bottom));
    width: auto;
    max-width: none;
    margin: 0;
    padding: 0 16px;
    background: transparent;
    border: 0;
    box-shadow: none;
    --mp-gap-top: 8px;
    --mp-gap-bottom: 0px;
    --mp-controls-gap: 0px;
    --mp-btn-center: 52px;
    --mp-btn-side: 44px;
    --mp-icon-center: 26px;
    --mp-icon-side: 36px;
    --mp-track-h: 3px;
    --mp-knob: 8px;
  }
  .ai-mini-root .ai-card{
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    border-radius: 18px;
    padding: 10px 12px 8px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.14);
  }
  .ai-mini-root .ai-meter{
    padding: 4px 0 0;
  }
  .ai-mini-root .ai-controls{
    gap: 16px;
    padding: 4px 0 0;
  }
  .ai-mini-root .ai-footer{
    padding: 2px 0 4px;
    margin-top: 4px;
    justify-content: space-between;
    font-size: 12px;
  }
  .ai-mini-root .ai-rate{
    font-size: 12px;
  }
  .ai-mini-root .ai-btn{
    border-radius: 12px;
  }
  .ai-mini-root .ai-btn.side svg,
  .ai-mini-root .ai-btn.side img{
    width: 20px;
    height: 20px;
  }
}

/* 4) Listen button: inline pill under the title (not floating) */
#ai-listen-btn,
.listen-btn{
  position: static !important;
  background: #3b2a1c !important;
  color: #fffdf8 !important;
  border: 2px solid #1a1c1a;
  border-radius: 9999px;
  padding: 8px 20px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  line-height: 1;
  box-shadow: 0 8px 18px rgba(0,0,0,.2);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: transform .08s ease, background-color .08s ease, box-shadow .08s ease;
}
#ai-listen-btn:hover,
#ai-listen-btn:focus-visible,
.listen-btn:hover,
.listen-btn:focus-visible{
  background: #2c1f15 !important;
  box-shadow: 0 0 0 1px #000;
  transform: translateY(-0.5px);
  outline: none;
}
#ai-listen-btn:active,
.listen-btn:active{
  transform: translateY(0);
  box-shadow: none;
}

.ai-mini-root[data-state="loading"]{
  opacity:0.75;
  pointer-events:none;
}

.ai-mini-root[data-state="loading"] #mp-play::after{
  content:'…';
  font-size:10px;
  margin-left:4px;
}

.ail-listen-button-wrapper{
  margin-top:0.5rem;
  margin-bottom:1rem;
}

.ail-listen-button-wrapper .ail-listen-button,
.ail-listen-button-wrapper .listen-btn,
.ail-listen-button-wrapper #ai-listen-btn{
  display:inline-block;
}

/* 5) Mobile niceties */
@media (max-width: 480px){
  #ai-listen-btn{ padding: 8px 12px; font-size:14px; }
}

 

/* 4) LISTEN BUTTON: stable, inline near author/byline (NO auto-hide) */
/* Add this if your article header has a wrapper */
.article-header .byline {
  display: flex;
  align-items: center;
  gap: 10px;       /* space between author and button */
  flex-wrap: wrap; /* safe on small screens */
}

.article-header .byline #ai-fab {
  position: static !important;   /* cancel out fixed positioning */
  margin-left: 12px;             /* spacing from author name */
}

.listen-btn,
#ai-fab, .ai-fab, [data-ai-fab], button[aria-label="Listen"]{
  position: static !important;
  background: #3b2a1c !important;
  color: #fffdf8 !important;
  border: 2px solid #1a1c1a;
  border-radius: 999px;
  padding: 8px 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  line-height: 1;
  box-shadow: 0 6px 14px rgba(0,0,0,.2);
  cursor: pointer;
  transition: transform .08s ease, background-color .08s ease, box-shadow .08s ease;
}

.listen-btn:hover,
.listen-btn:focus-visible,
#ai-fab:hover,
#ai-fab:focus-visible,
.ai-fab:hover,
.ai-fab:focus-visible,
[data-ai-fab]:hover,
[data-ai-fab]:focus-visible,
button[aria-label="Listen"]:hover,
button[aria-label="Listen"]:focus-visible{
  background: #2c1f15 !important;
  box-shadow: 0 0 0 1px #000;
  transform: translateY(-0.5px);
  outline: none;
}
.listen-btn:active,
#ai-fab:active,
.ai-fab:active,
[data-ai-fab]:active,
button[aria-label="Listen"]:active{
  transform: translateY(0);
  box-shadow: none;
}

/* 5) DISABLE any global auto-hide rules for FAB while mini is open */
body:has(.ai-mini-root.show) #ai-fab,
body:has(.ai-mini-root.show) .ai-fab,
body:has(.ai-mini-root.show) [data-ai-fab]{
  display: inline-flex !important;   /* keep it visible */
}

/* 6) MOBILE niceties */
@media (max-width: 480px){
  .listen-btn{ padding: 8px 12px; font-size: 14px; }
}

/* Card */
.ai-card{
  width: 100%;
  max-width: 100%;
  margin: 0;
  background: var(--mp-bg);
  color: var(--mp-fg);
  border: 1px solid var(--mp-border);
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
  font-family: var(--mp-font);
  padding: 12px 14px 8px;
}

/* Title (ellipsis that actually works) */
.ai-title{
  display: block;
  max-width: 100%;
  min-width: 0;                         /* <- key for ellipsis within flex/grid */
  font-weight: 650; font-size: 15px; line-height: 1.25;
  margin-bottom: 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: center;
}

/* Meter wrapper */
.ai-meter{
  margin-top: var(--mp-gap-top);
  margin-bottom: var(--mp-gap-bottom);
  width: 100%;
  padding: 8px 16px 0;
  box-sizing: border-box;
}

/* Progress */
.ai-progress{
  display: flex; align-items: center; justify-content: center;
  width: 100%;
}
.ai-range{
  -webkit-appearance: none; appearance: none;
  width: 100%; height: var(--mp-track-h);
  background: var(--mp-progress-bg);
  border-radius: 999px; outline: none;
  margin: 0 8px;
}
.ai-range::-webkit-slider-thumb{
  -webkit-appearance: none; appearance: none;
  width: var(--mp-knob); height: var(--mp-knob);
  border-radius: 50%;
  background: var(--mp-progress-fill);
  border: 0;
  margin-top: calc((var(--mp-track-h) - var(--mp-knob)) / 2);
  cursor: pointer;
}
/* Firefox track/thumb */
.ai-range::-moz-range-track{
  height: var(--mp-track-h); background: var(--mp-progress-bg);
  border-radius: 999px; border: none;
}
.ai-range::-moz-range-thumb{
  width: var(--mp-knob); height: var(--mp-knob);
  border-radius: 50%; background: var(--mp-progress-fill); border: none;
}

/* Time row */
/* Time row */
.ai-timebar{
  margin-top: 6px;
  display: flex; justify-content: space-between;
  font-size: 12px; color: var(--mp-muted);
}
#mp-elapsed, #mp-total{
  line-height: 1;
}

/* Controls row */
.ai-controls{
  margin-top: var(--mp-controls-gap);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
  padding: 8px 16px 0;
}

/* Buttons */
.ai-btn{
  position: relative;
  display: block;
  width: var(--mp-btn-center);
  height: var(--mp-btn-center);
  line-height: 0; overflow: hidden;
  border-radius: 12px;
  border: 1px solid var(--mp-border);
  background: #f7e5cc;
  color: var(--mp-fg);
  cursor: pointer;
  transition: transform .08s ease, border-color .12s ease, background .12s ease;
}
.ai-btn:hover{ border-color: #d7b78d; }
.ai-btn:active{ transform: translateY(1px) scale(.98); }
.ai-btn.side{ width: var(--mp-btn-side); height: var(--mp-btn-side); }

/* Single centering method */
.ai-btn svg, .ai-btn img{
  position: absolute;
  inset: 0; margin: auto;
  width: var(--mp-icon-center);
  height: var(--mp-icon-center);
  transform: translate(var(--mp-center-nudge-x), var(--mp-center-nudge-y));
}
.ai-btn.side svg, .ai-btn.side img{
  width: 24px;
  height: 24px;
  transform: translate(0, 0);
}

.ai-btn svg{
  fill: currentColor;
  stroke: currentColor;
  display: block;
}
.ai-btn svg *{
  fill: currentColor;
  stroke: currentColor;
}

/* Custom icons via mask */
:root{
  --mp-icon: 18px;
  --icon-play:  url('/static/icons/my-play.svg');
  --icon-pause: url('/static/icons/my-pause.svg');
  --icon-back:  url('/static/icons/my-back.svg');
  --icon-fwd:   url('/static/icons/my-fwd.svg');
}
html.custom-icons .ai-btn svg{ display:none; }
html.custom-icons .ai-btn::before{
  content:"";
  position:absolute; inset:0; margin:auto;
  width: var(--mp-icon-center); height: var(--mp-icon-center);
  background-color: currentColor;
  -webkit-mask-repeat:no-repeat; -webkit-mask-position:center; -webkit-mask-size:contain;
          mask-repeat:no-repeat;         mask-position:center;         mask-size:contain;
  transform: translate(var(--mp-center-nudge-x), var(--mp-center-nudge-y));
}
html.custom-icons .ai-btn.side::before{
  width: var(--mp-icon-side); height: var(--mp-icon-side);
  transform: translate(var(--mp-side-nudge-x), var(--mp-side-nudge-y));
}
html.custom-icons .ai-btn[data-icon="play"]::before  { -webkit-mask-image: var(--icon-play);  mask-image: var(--icon-play);  }
html.custom-icons .ai-btn[data-icon="pause"]::before { -webkit-mask-image: var(--icon-pause); mask-image: var(--icon-pause); }
html.custom-icons .ai-btn[data-icon="back"]::before  { -webkit-mask-image: var(--icon-back);  mask-image: var(--icon-back);  }
html.custom-icons .ai-btn[data-icon="fwd"]::before   { -webkit-mask-image: var(--icon-fwd);   mask-image: var(--icon-fwd);   }

/* Footer / rate */
.ai-footer{
  margin-top: 6px;
  display:flex;
  align-items:flex-end;
  justify-content:flex-start;
  padding: 4px 16px 12px;
  font-size: 13px;
  color: var(--mp-muted);
}
.ai-rate{
  -webkit-appearance: none; appearance: none;
  background: transparent; border: 0; padding: 0;
  font-size: 12px; line-height: 1; color: currentColor;
}

/* Mobile tweaks */
@media (max-width: 420px){
  .ai-card{ padding: 12px 12px 8px; }
  .ai-title{ font-size: 14px; }
  .ai-btn{ width: 40px; height: 40px; }
  .ai-btn.primary{ width: 50px; height: 50px; }
}

/* Close (×): just a grey glyph, no box/border) */
.ai-close{
  position:absolute; top:6px; left:6px;
  width:24px; height:24px;
  display:grid; place-items:center;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  color:#1a1c1a;
  cursor:pointer;
  padding: 0;
}
.ai-close svg{
  width: 14px;
  height: 14px;
  display: block;
}

/* Overlay for click-outside to close */
#ai-overlay{
  position:fixed; inset:0;
  background: transparent;
  z-index: 999996;
  pointer-events:none; opacity:0; transition: opacity .12s ease;
}
#ai-overlay.show{ pointer-events:auto; opacity:1; }

@media (max-width: 640px){
  .ai-mini-root .ai-controls{
    width: 100%;
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  .ai-mini-root .ai-footer{
    width: 100%;
    justify-content: flex-end;
  }
}

/* Reserve space when open (JS toggles .ai-mini-open) */
html.ai-mini-open body,
html.ai-mini-open main{
  padding-bottom: calc(var(--ai-mini-pad, 140px) + env(safe-area-inset-bottom));
}

body.ai-mini-open,
.ai-mini-open body{
  padding-bottom: 120px;
}


/* Hide track title in the mini player for a cleaner look */
.ai-mini-root .ai-title {
  display: none !important;
}

/* EasyAudio demo: higher contrast + full outline */
.ai-mini-root {
  box-sizing: border-box;
  border-radius: 16px;
  border: 1px solid rgba(0, 0, 0, 0.28);
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08);
}

/* Make time labels and rate text solid black for readability */
.ai-mini-root .ai-time,
.ai-mini-root .ai-duration,
.ai-mini-root #mp-elapsed,
.ai-mini-root #mp-total,
.ai-mini-root .ai-rate,
.ai-mini-root .ai-speed,
.ai-mini-root .ai-meta {
  color: #000;
}

/* ==== FINAL POSITIONING OVERRIDES (desktop + mobile) ==== */

/* Desktop / default: bottom-right floating card, never clipped */
.ai-mini-root {
  position: fixed;
  z-index: 9999;
  bottom: calc(24px + env(safe-area-inset-bottom));
  right: 24px;
  left: auto;
  width: min(320px, 100vw - 48px);
  max-width: 100%;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* The visible card just fills the wrapper on desktop */
.ai-mini-root .ai-card {
  width: 100%;
  max-width: 100%;
  margin: 0;
}

/* Mobile: bottom-centered bar with equal padding left/right */
@media (max-width: 768px) {
  .ai-mini-root {
    bottom: calc(8px + env(safe-area-inset-bottom));
    left: 0;
    right: 0;
    width: auto;
    max-width: 100%;
    margin: 0;
    padding: 0 12px;              /* equal inset on both sides */
    box-sizing: border-box;
  }

  .ai-mini-root .ai-card {
    width: 100%;
    max-width: 360px;             /* don’t get too wide */
    margin: 0 auto;               /* center the card */
  }
}

 
