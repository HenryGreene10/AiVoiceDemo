
/* === AI Listen overrides (place at very end) === */

/* 1) Remove close (×) and reclaim space */
.ai-close { display: none !important; }
.ai-card { padding-top: 12px; }

/* 2) Title: true ellipsis */
.ai-title{
  display:block;
  max-width:100%;
  min-width:0;
  font-weight:650; font-size:15px; line-height:1.25;
  margin:0 0 8px 0;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  text-align:center;
}

/* 3) Single mini-player placement (keep ONE copy only) */
#ai-mini{
  position: fixed;
  right: 18px;
  bottom: calc(18px + env(safe-area-inset-bottom));
  transform: translateY(120%) scale(.98);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
  z-index: 999998;
}
#ai-mini.show{ transform: translateY(0) scale(1); opacity:1; }
#ai-mini.hidden{ pointer-events:none; }

/* 4) Listen button: inline pill under the title (not floating) */
#ai-listen-btn, .listen-btn{
  position: static !important;       /* cancel any fixed/floating */
  background: inherit !important;    /* match page bg */
  color: inherit !important;         /* match page text */
  border: 3px solid color-mix(in srgb, currentColor 40%, transparent);
  border-radius: 9999px;
  padding: 8px 14px;
  font-weight: 650;
  line-height: 1;
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
  cursor: pointer;
  display: inline-flex; align-items: center; gap: 8px;
}
#ai-listen-btn:hover{ filter: brightness(0.98); border-color: color-mix(in srgb, currentColor 55%, transparent); }
#ai-listen-btn:active{ transform: translateY(1px); }

/* 5) Mobile niceties */
@media (max-width: 480px){
  #ai-listen-btn{ padding: 8px 12px; font-size:14px; }
  .ai-card{ width: min(96vw, 420px); }
}

 

/* 4) LISTEN BUTTON: stable, inline near author/byline (NO auto-hide) */
/* Add this if your article header has a wrapper */
.article-header .byline {
  display: flex;
  align-items: center;
  gap: 10px;       /* space between author and button */
  flex-wrap: wrap; /* safe on small screens */
}

.article-header .byline #ai-fab {
  position: static !important;   /* cancel out fixed positioning */
  margin-left: 12px;             /* spacing from author name */
}

/* Generic Listen button look that matches page */
.listen-btn,
#ai-fab, .ai-fab, [data-ai-fab], button[aria-label="Listen"]{
  position: static !important;        /* not fixed: lives in the header row */
  background: inherit !important;     /* match page bg */
  color: inherit !important;          /* match page text color */
  border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
  border-radius: 999px;
  padding: 8px 14px;
  font-weight: 650;
  line-height: 1;
  box-shadow: 0 4px 12px rgba(0,0,0,.12);
  cursor: pointer;
}

/* Hover/active polish */
.listen-btn:hover{ filter: brightness(0.98); }
.listen-btn:active{ transform: translateY(1px); }

/* 5) DISABLE any global auto-hide rules for FAB while mini is open */
body:has(#ai-mini.show) #ai-fab,
body:has(#ai-mini.show) .ai-fab,
body:has(#ai-mini.show) [data-ai-fab]{
  display: inline-flex !important;   /* keep it visible */
}

/* 6) MOBILE niceties */
@media (max-width: 480px){
  .listen-btn{ padding: 8px 12px; font-size: 14px; }
  .ai-card{ width: min(96vw, 420px); }
}

/* ---- Mini Player • Compact Card v3 (clean) ---- */
:root{
  /* theme (kept for shadows/borders only) */
  --mp-font: inherit;
  --mp-bg: rgba(16, 20, 24, .92);
  --mp-fg: inherit;                 /* <- text follows page color */
  --mp-muted: color-mix(in srgb, currentColor 55%, transparent);
  --mp-accent: color-mix(in srgb, currentColor 40%, #4DA3FF 60%);
  --mp-border: color-mix(in srgb, currentColor 12%, transparent);
  --mp-radius: 16px;
  --mp-shadow: 0 20px 50px rgba(0,0,0,.25);

  /* layout spacing */
  --mp-gap-top:      20px;
  --mp-gap-bottom:    0px;
  --mp-controls-gap:  1px;

  /* sizing */
  --mp-width: 820px;

  /* buttons and icons */
  --mp-btn-center: 56px;
  --mp-btn-side:   42px;
  --mp-icon-center: 30px;
  --mp-icon-side:   56px;

  /* progress */
  --mp-track-h: 1px;
  --mp-knob:    4px;
  --mp-progress-bg: color-mix(in srgb, currentColor 15%, transparent);
  --mp-progress-fill: currentColor;

  /* icon nudges */
  --mp-center-nudge-x: 0px;
  --mp-center-nudge-y: 0px;
  --mp-side-nudge-x:   -7.5px;
  --mp-side-nudge-y:   0px;
}

 

/* Card */
.ai-card{
  width: min(var(--mp-width), 96vw);
  background: inherit !important;      /* <- match page background */
  color: var(--mp-fg);                  /* <- follow page text color */
  border: 1px solid var(--mp-border);
  border-radius: var(--mp-radius);
  box-shadow:
    0 24px 70px rgba(0,0,0,.28),
    0 0 0 1px var(--mp-border);
  font-family: var(--mp-font);
  padding: 12px 14px 8px;
}

/* Title (ellipsis that actually works) */
.ai-title{
  display: block;
  max-width: 100%;
  min-width: 0;                         /* <- key for ellipsis within flex/grid */
  font-weight: 650; font-size: 15px; line-height: 1.25;
  margin-bottom: 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: center;
}

/* Meter wrapper */
.ai-meter{ margin-top: var(--mp-gap-top); margin-bottom: var(--mp-gap-bottom); }

/* Progress */
.ai-progress{
  display: flex; align-items: center; justify-content: center;
  width: 100%;
}
.ai-range{
  -webkit-appearance: none; appearance: none;
  width: 100%; height: var(--mp-track-h);
  background: var(--mp-progress-bg);
  border-radius: 999px; outline: none;
  margin: 0 8px;
}
.ai-range::-webkit-slider-thumb{
  -webkit-appearance: none; appearance: none;
  width: var(--mp-knob); height: var(--mp-knob);
  border-radius: 50%;
  background: var(--mp-progress-fill);
  border: 0;
  margin-top: calc((var(--mp-track-h) - var(--mp-knob)) / 2);
  cursor: pointer;
}
/* Firefox track/thumb */
.ai-range::-moz-range-track{
  height: var(--mp-track-h); background: var(--mp-progress-bg);
  border-radius: 999px; border: none;
}
.ai-range::-moz-range-thumb{
  width: var(--mp-knob); height: var(--mp-knob);
  border-radius: 50%; background: var(--mp-progress-fill); border: none;
}

/* Time row */
.ai-timebar{
  margin-top: 6px;
  display: flex; justify-content: space-between;
  font-size: 12px; color: var(--mp-muted);
}

/* Controls row */
.ai-controls{
  margin-top: var(--mp-controls-gap);
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  justify-items: center; align-items: center;
}

/* Buttons */
.ai-btn{
  position: relative;
  display: block;
  width: var(--mp-btn-center);
  height: var(--mp-btn-center);
  line-height: 0; overflow: hidden;
  border-radius: 12px;
  border: 1px solid var(--mp-border);
  background: color-mix(in srgb, currentColor 6%, transparent); /* subtle tint of page color */
  color: currentColor;
  cursor: pointer;
  transition: transform .08s ease, border-color .12s ease, background .12s ease;
}
.ai-btn:hover{ border-color: color-mix(in srgb, var(--mp-accent) 60%, transparent); }
.ai-btn:active{ transform: translateY(1px) scale(.98); }
.ai-btn.side{ width: var(--mp-btn-side); height: var(--mp-btn-side); }

/* Single centering method */
.ai-btn svg, .ai-btn img{
  position: absolute;
  inset: 0; margin: auto;
  width: var(--mp-icon-center);
  height: var(--mp-icon-center);
  transform: translate(var(--mp-center-nudge-x), var(--mp-center-nudge-y));
}
.ai-btn.side svg, .ai-btn.side img{
  width: var(--mp-icon-side);
  height: var(--mp-icon-side);
  transform: translate(var(--mp-side-nudge-x), var(--mp-side-nudge-y));
}

/* Custom icons via mask */
:root{
  --mp-icon: 18px;
  --icon-play:  ;
  --icon-pause: ;
  --icon-back:  ;
  --icon-fwd:   ;
}
html.custom-icons .ai-btn svg{ display:none; }
html.custom-icons .ai-btn::before{
  content:"";
  position:absolute; inset:0; margin:auto;
  width: var(--mp-icon-center); height: var(--mp-icon-center);
  background-color: currentColor;
  -webkit-mask-repeat:no-repeat; -webkit-mask-position:center; -webkit-mask-size:contain;
          mask-repeat:no-repeat;         mask-position:center;         mask-size:contain;
  transform: translate(var(--mp-center-nudge-x), var(--mp-center-nudge-y));
}
html.custom-icons .ai-btn.side::before{
  width: var(--mp-icon-side); height: var(--mp-icon-side);
  transform: translate(var(--mp-side-nudge-x), var(--mp-side-nudge-y));
}
html.custom-icons .ai-btn[data-icon="play"]::before  { -webkit-mask-image: var(--icon-play);  mask-image: var(--icon-play);  }
html.custom-icons .ai-btn[data-icon="pause"]::before { -webkit-mask-image: var(--icon-pause); mask-image: var(--icon-pause); }
html.custom-icons .ai-btn[data-icon="back"]::before  { -webkit-mask-image: var(--icon-back);  mask-image: var(--icon-back);  }
html.custom-icons .ai-btn[data-icon="fwd"]::before   { -webkit-mask-image: var(--icon-fwd);   mask-image: var(--icon-fwd);   }

/* Footer / rate */
.ai-footer{ margin-top: 6px; display:flex; align-items:flex-end; justify-content:flex-start; }
.ai-rate{
  -webkit-appearance: none; appearance: none;
  background: transparent; border: 0; padding: 0;
  font-size: 12px; line-height: 1; color: currentColor;
}

/* Mobile tweaks */
@media (max-width: 420px){
  .ai-card{ padding: 12px 12px 8px; }
  .ai-title{ font-size: 14px; }
  .ai-btn{ width: 40px; height: 40px; }
  .ai-btn.primary{ width: 50px; height: 50px; }
}

/* Close (×): just a grey glyph, no box/border) */
.ai-close{
  position:absolute; top:6px; left:6px;
  width:24px; height:24px;
  display:grid; place-items:center;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  color:#6b7280;
  cursor:pointer;
}
.ai-close:after{ content:"×"; font-size:16px; font-weight:700; line-height:1; }

/* Overlay for click-outside to close */
#ai-overlay{
  position:fixed; inset:0;
  background: transparent;
  z-index: 999996;
  pointer-events:none; opacity:0; transition: opacity .12s ease;
}
#ai-overlay.show{ pointer-events:auto; opacity:1; }

 
